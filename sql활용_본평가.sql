CREATE TABLE WRITER(
	WRITER_NO VARCHAR2(12),
	WRITER_NAME VARCHAR2(30)
);

ALTER TABLE WRITER ADD CONSTRAINT WRITER_PK PRIMARY KEY(WRITER_NO);


CREATE TABLE PUBLISHER(
	PUBLISHER_NO VARCHAR2(10),
	PUBLISHER_NAME VARCHAR2(30)
);
ALTER TABLE PUBLISHER ADD CONSTRAINT PUBLISHER_PK PRIMARY KEY(PUBLISHER_NO);


CREATE TABLE BOOK(
	ISBN VARCHAR2(12),
	TITLE VARCHAR2(50),
	WRITER_NO VARCHAR2(10),
	PUBLISHER_NO VARCHAR2(10),
	MONEY NUMBER(7)
);

ALTER TABLE BOOK ADD CONSTRAINT BOOK_PK PRIMARY KEY(ISBN);

ALTER TABLE BOOK ADD CONSTRAINT BOOK_FK_WRITER_NO FOREIGN KEY(WRITER_NO)
REFERENCES WRITER(WRITER_NO) ON DELETE CASCADE;
ALTER TABLE BOOK ADD CONSTRAINT BOOK_FK_PUBLISHER_NO FOREIGN KEY(PUBLISHER_NO)
REFERENCES PUBLISHER(PUBLISHER_NO) ON DELETE CASCADE;

INSERT INTO WRITER VALUES('W0001','홍길동');
INSERT INTO WRITER VALUES('W0002','강병우');
INSERT INTO WRITER VALUES('W0003','박정후');
INSERT INTO WRITER VALUES('W0004','조민성');
INSERT INTO WRITER VALUES('W0005','김시수');

INSERT INTO PUBLISHER VALUES('P0001','창작사');
INSERT INTO PUBLISHER VALUES('P0002','컴퓨터 미디어');
INSERT INTO PUBLISHER VALUES('P0003','아트와 컬쳐');
INSERT INTO PUBLISHER VALUES('P0004','코멧');
INSERT INTO PUBLISHER VALUES('P0005','인터즈');

INSERT INTO BOOK VALUES('68545641','이것이 리눅스','W0001','P0001',36000);
INSERT INTO BOOK VALUES('12313542','자료구조','W0002','P0002',36000);
INSERT INTO BOOK VALUES('45487788','디자인 패턴','W0001','P0003',36000);
INSERT INTO BOOK VALUES('45646546','자바의 정석','W0003','P0003',36000);
INSERT INTO BOOK VALUES('15972348','안드로이드 개발의 정석','W0003','P0004',36000);

SAVEPOINT DATA_FIN;

CREATE INDEX BOOK_IDX ON BOOK(TITLE, WRITER_NO);

SELECT W.* FROM BOOK B RIGHT OUTER JOIN WRITER W ON B.WRITER_NO = W.WRITER_NO
WHERE  B.ISBN IS NULL;

SELECT B.ISBN, B.TITLE, W.WRITER_NAME, P.PUBLISHER_NAME, B.MONEY 
FROM BOOK B JOIN WRITER W ON B.WRITER_NO = W.WRITER_NO
JOIN PUBLISHER P ON B.PUBLISHER_NO = P.PUBLISHER_NO;

CREATE VIEW BOOK_LIST_VIEW
AS
SELECT B.ISBN, B.TITLE, W.WRITER_NAME, P.PUBLISHER_NAME, B.MONEY 
FROM BOOK B JOIN WRITER W ON B.WRITER_NO = W.WRITER_NO
JOIN PUBLISHER P ON B.PUBLISHER_NO = P.PUBLISHER_NO;

SELECT * FROM BOOK_LIST_VIEW;